from base64 import b64decode
from pwn import *
import PIL.Image as Image
from numpy import asarray

d = {
    "212222": "space",
    "222122": "!",
    "222221": '"',
    "121223": "#",
    "121322": "$",
    "131222": "%",
    "122213": "&",
    "122312": " ",
    "132212": "(",
    "221213": ")",
    "221312": "*",
    "231212": "+",
    "112232": ",",
    "122132": "-",
    "122231": ".",
    "113222": "/",
    "123122": "0",
    "123221": "1",
    "223211": "2",
    "221132": "3",
    "221231": "4",
    "213212": "5",
    "223112": "6",
    "312131": "7",
    "311222": "8",
    "321122": "9",
    "321221": ":",
    "312212": ";",
    "322112": "<",
    "322211": "=",
    "212123": ">",
    "212321": "?",
    "232121": "@",
    "111323": "A",
    "131123": "B",
    "131321": "C",
    "112313": "D",
    "132113": "E",
    "132311": "F",
    "211313": "G",
    "231113": "H",
    "231311": "I",
    "112133": "J",
    "112331": "K",
    "132131": "L",
    "113123": "M",
    "113321": "N",
    "133121": "O",
    "313121": "P",
    "211331": "Q",
    "231131": "R",
    "213113": "S",
    "213311": "T",
    "213131": "U",
    "311123": "V",
    "311321": "W",
    "331121": "X",
    "312113": "Y",
    "312311": "Z",
    "332111": "[",
    "314111": "\\",
    "221411": "]",
    "431111": "^",
    "111224": "_",
    "111422": "`",
    "121124": "a",
    "121421": "b",
    "141122": "c",
    "141221": "d",
    "112214": "e",
    "112412": "f",
    "122114": "g",
    "122411": "h",
    "142112": "i",
    "142211": "j",
    "241211": "k",
    "221114": "l",
    "413111": "m",
    "241112": "n",
    "134111": "o",
    "111242": "p",
    "121142": "q",
    "121241": "r",
    "114212": "s",
    "124112": "t",
    "124211": "u",
    "411212": "v",
    "421112": "w",
    "421211": "x",
    "212141": "y",
    "214121": "z",
    "412121": "{",
    "111143": "|",
    "111341": "}",
    "131141": "~",
    "114113": "DEL",
    "114311": "FNC3",
    "411113": "FNC2",
    "411311": "ShiftA",
    "113141": "CodeC",
    "114131": "FNC4",
    "311141": "CodeA",
    "411131": "FNC1",
    "211412": "Start",
    "211214": "Start",
    "211232": "Start",
    "2331112": "Stop"}

t = remote('challenge.404ctf.fr', 30566)
for _ in range(128):
    t.recvline()
    img = Image.open(io.BytesIO(b64decode(t.recvline().strip().decode())))
    arr = asarray(img)[0][:, 0]//255
    cipher = []
    local = ""
    ref = arr[0]
    count = 0
    for el in arr:
        if ref != el:
            local += str(count)
            if len(local) == 6:
                cipher.append(local)
                local = ""
            ref = el
            count = 1
        else:
            count += 1
    local += str(count)
    cipher.append(local)

    print(cipher)
    print(m := "".join([d[k] for k in cipher]))
    t.sendline(m)
    t.recvline()

t.interactive()
